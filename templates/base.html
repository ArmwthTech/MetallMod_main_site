<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or 'МеталлМод' }}</title>
    <meta name="description" content="{{ description or 'Профессиональная разработка чертежей КМД для металлоконструкций любой сложности. Проекты, портфолио, отзывы, расчет стоимости.' }}">
    <meta name="keywords" content="КМД, металлоконструкции, чертежи, проектирование, Екатеринбург, портфолио, отзывы, расчет стоимости, заказать КМД, МеталлМод">
    <link rel="canonical" href="{{ request.url if request else '' }}">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Подключение шрифтов -->
    <link href="https://fonts.googleapis.com/css?family=Inter:400,700&display=swap" rel="stylesheet">
    <link href="https://fonts-online.ru/fonts/baron-neue" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" type="image/png" href="/static/logo-favicon.png">
    <!-- Open Graph -->
    <meta property="og:title" content="{{ title or 'МеталлМод — чертежи КМД и металлоконструкций' }}">
    <meta property="og:description" content="{{ description or 'Профессиональная разработка чертежей КМД для металлоконструкций любой сложности.' }}">
    <meta property="og:image" content="/static/logo.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url if request else '' }}">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ title or 'МеталлМод — чертежи КМД и металлоконструкций' }}">
    <meta name="twitter:description" content="{{ description or 'Профессиональная разработка чертежей КМД для металлоконструкций любой сложности.' }}">
    <meta name="twitter:image" content="/static/logo.jpg">
    <style>
      html {
        scroll-padding-top: 100px; /* Отступ для 'прилипающей' шапки */
      }
      .fade-in { opacity: 0; transform: translateY(30px); transition: opacity 0.8s cubic-bezier(.4,0,.2,1), transform 0.8s cubic-bezier(.4,0,.2,1); }
      .fade-in.visible { opacity: 1; transform: none; }
      .slide-up { opacity: 0; transform: translateY(60px) scale(0.98); transition: opacity 0.8s, transform 0.8s; }
      .slide-up.visible { opacity: 1; transform: none; }
      .scale-in { opacity: 0; transform: scale(0.92); transition: opacity 0.8s, transform 0.8s; }
      .scale-in.visible { opacity: 1; transform: scale(1); }
      /* Кастомный breakpoint для меню */
      @media (max-width: 1145px) {
        .desktop-header-menu { display: none !important; }
        .burger-header-btn { display: block !important; }
      }
      @media (min-width: 1146px) {
        .desktop-header-menu { display: flex !important; }
        .burger-header-btn { display: none !important; }
      }
      [data-theme="dark"] #logo-title,
      [data-theme="dark"] #footer-logo-title {
        text-shadow: none !important;
      }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "МеталлМод",
      "url": "https://metallmod.ru/",
      "logo": "https://metallmod.ru/static/logo.jpg",
      "contactPoint": [{
        "@type": "ContactPoint",
        "telephone": "+7-999-527-42-10",
        "contactType": "customer service",
        "areaServed": "RU",
        "availableLanguage": ["Russian", "English"]
      }],
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Екатеринбург",
        "streetAddress": "Первомайская 56",
        "addressCountry": "RU"
      }
    }
    </script>
</head>
<body style="background:var(--color-bg);color:var(--color-text);" class="font-sans">
    <!-- Toast notifications -->
    <div id="toast-container" class="fixed top-6 right-6 z-[100] flex flex-col gap-3 items-end"></div>
    <header style="background:var(--color-header);color:var(--color-header-text);" class="shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex items-center justify-between p-4">
            <div class="flex items-center gap-4 cursor-pointer justify-center min-h-12" id="logo-scroll-top" style="min-width: 0;">
                <img src="/static/logo.jpg" alt="Логотип МеталлМод — чертежи КМД и металлоконструкций" class="h-12 w-12 object-contain rounded-full align-middle translate-y-1" style="min-width:48px;">
                <span class="text-3xl font-extrabold tracking-tight flex items-center align-middle" style="font-family: 'Baron Neue', Inter, sans-serif; text-shadow: 0 0 2px #fff, 0 0 6px #fff;" id="logo-title">
                    <span style="color:var(--color-text);">Металл</span><span style="color:var(--color-accent);">Мод</span>
                </span>
            </div>

            <!-- Меню для десктопа -->
            <div class="desktop-header-menu items-center gap-6" style="display: flex;">
                <nav id="main-nav" class="flex gap-6 text-lg font-medium items-center">
                    <a href="#services" class="hover:text-[#ff590d] transition-colors">Услуги</a>
                    <a href="#portfolio" class="hover:text-[#ff590d] transition-colors">Портфолио</a>
                    <a href="#steps" class="hover:text-[#ff590d] transition-colors">Этапы</a>
                    <a href="#reviews" class="hover:text-[#ff590d] transition-colors">Отзывы</a>
                    <a href="#contacts" class="hover:text-[#ff590d] transition-colors">Контакты</a>
                </nav>
                <div class="flex items-center gap-x-4">
                    <div class="text-right">
                        <a href="tel:+79995274210" class="text-base font-bold hover:text-[#ff590d] transition-colors flex items-center justify-end gap-1.5">
                            <i class="fa fa-phone text-base"></i>+7 (999) 527-42-10
                        </a>
                        <div class="text-xs text-gray-500 mt-0.5">Пн–Пт 9:00–18:00</div>
                    </div>
                    <div class="flex gap-2">
                        <button id="header-km-modal-btn-desktop" class="bg-[#ff590d] hover:bg-orange-600 text-white px-3 py-1.5 rounded-xl font-semibold shadow-md transition whitespace-nowrap text-sm">Оставить заявку</button>
                    </div>
                    <div class="flex items-center gap-1 text-sm font-semibold">
                        <a href="?lang=ru" class="hover:text-[#ff590d] transition-colors {{ 'font-bold underline' if lang == 'ru' else '' }}">RU</a>
                        <span class="opacity-50">|</span>
                        <a href="?lang=en" class="hover:text-[#ff590d] transition-colors {{ 'font-bold underline' if lang == 'en' else '' }}">EN</a>
                        <button id="theme-toggle-btn" title="Переключить тему" class="ml-2 text-xl focus:outline-none" style="background:none; border:none; cursor:pointer;">
                            <i id="theme-toggle-icon" class="fa fa-moon"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Кнопка-бургер для мобильных -->
            <button id="burger-btn" class="burger-header-btn text-2xl text-[#123392] focus:outline-none">
                <i class="fa fa-bars"></i>
            </button>
        </div>

        <!-- Мобильное меню -->
        <div id="mobile-menu" class="hidden border-t border-gray-200" style="background:var(--color-block);color:var(--color-text);">
            <nav class="flex flex-col items-center gap-4 p-4">
                <a href="#services" class="mobile-menu-link text-lg" style="color:var(--color-text);">Услуги</a>
                <a href="#portfolio" class="mobile-menu-link text-lg" style="color:var(--color-text);">Портфолио</a>
                <a href="#steps" class="mobile-menu-link text-lg" style="color:var(--color-text);">Этапы</a>
                <a href="#reviews" class="mobile-menu-link text-lg" style="color:var(--color-text);">Отзывы</a>
                <a href="#contacts" class="mobile-menu-link text-lg" style="color:var(--color-text);">Контакты</a>
            </nav>
            <div class="flex flex-col items-center gap-4 p-4 border-t border-gray-100">
                 <div class="text-center">
                    <a href="tel:+79995274210" class="text-base font-bold flex items-center justify-center gap-1.5" style="color:var(--color-text);"> <i class="fa fa-phone text-base"></i>+7 (999) 527-42-10</a>
                    <div class="text-xs mt-0.5" style="color:var(--color-secondary);">Пн–Пт 9:00–18:00</div>
                </div>
                <button id="header-km-modal-btn-mobile" class="w-full rounded-xl font-semibold shadow-md" style="background:var(--color-accent);color:#fff;">Оставить заявку</button>
                <a href="https://t.me/metallmod_bot" target="_blank" class="w-full rounded-xl font-semibold shadow-md flex items-center justify-center gap-1.5" style="background:var(--color-header);color:var(--color-header-text);"><i class="fab fa-telegram-plane"></i> Telegram</a>
                <div class="flex items-center gap-2 text-sm font-semibold">
                    <a href="?lang=ru" style="color:var(--color-text);" class="hover:text-[#ff590d] {{ 'font-bold underline' if lang == 'ru' else '' }}">RU</a>
                    <span class="opacity-50">|</span>
                    <a href="?lang=en" style="color:var(--color-text);" class="hover:text-[#ff590d] {{ 'font-bold underline' if lang == 'en' else '' }}">EN</a>
                </div>
            </div>
        </div>
    </header>
    <main class="min-h-[70vh]">
        {% block content %}{% endblock %}
    </main>
    {% block footer %}
    <footer style="background:var(--color-footer);color:var(--color-footer-text);" class="py-10 px-4 mt-16">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-start gap-8">
            <div class="flex flex-col gap-3 mb-6 md:mb-0">
                <div class="flex items-center gap-3">
                    <img src="/static/logo.jpg" alt="Логотип" class="h-10 w-10 object-contain rounded-full" style="min-width:40px;">
                    <span class="text-2xl font-extrabold tracking-tight" style="font-family: 'Baron Neue', Inter, sans-serif;" id="footer-logo-title">
                        <span style="color:#fff;">Металл</span><span style="color:var(--color-accent);">Мод</span>
                    </span>
                </div>
                <span class="text-sm opacity-80">Профессиональная разработка чертежей КМД для металлоконструкций любой сложности</span>
            </div>
            <div class="flex flex-col gap-2 text-lg font-medium" id="footer-nav">
                <a href="/#services" class="footer-anchor hover:text-[#ff590d] transition-colors">Услуги</a>
                <a href="/#portfolio" class="footer-anchor hover:text-[#ff590d] transition-colors">Портфолио</a>
                <a href="/#steps" class="footer-anchor hover:text-[#ff590d] transition-colors">Этапы</a>
                <a href="/#reviews" class="footer-anchor hover:text-[#ff590d] transition-colors">Отзывы</a>
                <a href="/#contacts" class="footer-anchor hover:text-[#ff590d] transition-colors">Контакты</a>
            </div>
            <div class="flex flex-col gap-2 text-lg">
                <div class="flex items-center gap-2"><i class="fa fa-map-marker-alt"></i>Свердловская область,<br>г. Екатеринбург, Первомайская 56</div>
                <div class="flex items-center gap-2"><i class="fa fa-phone"></i> <a href="tel:+79995274210" target="_blank" class="hover:text-[#ff590d] transition-colors"> +7 (999) 527-42-10</a></div>
                <div class="flex items-center gap-2"><i class="fa fa-envelope"></i> <a href="mailto:info@metallmod.ru" target="_blank" class="hover:text-[#ff590d] transition-colors"> info@metallmod.ru</a></div>
                <div class="flex items-center gap-2"><i class="fab fa-telegram-plane"></i> <a href="https://t.me/metallmod_bot" target="_blank" class="hover:text-[#ff590d] transition-colors">Telegram</a></div>
            </div>
        </div>
        <div class="max-w-7xl mx-auto mt-8 border-t border-white/20 pt-6 text-center text-sm opacity-70" id="footer-year">
            &copy; <span id="year"></span> МеталлМод. Все права защищены.<br>
            <a href="/consent" target="_blank" class="underline hover:text-[#ff590d] mx-2">Согласие на обработку персональных данных</a> |
            <a href="/policy" target="_blank" class="underline hover:text-[#ff590d] mx-2">Политика в отношении обработки персональных данных</a>
        </div>
    </footer>
    {% endblock %}
    <script>
    // Toast notifications
    function showToast(message, type = 'success', timeout = 3500) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `flex items-center gap-3 px-6 py-4 rounded-2xl shadow-xl text-lg font-semibold animate-toast-in ${type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}`;
        toast.innerHTML = type === 'success'
            ? `<i class='fa fa-check-circle text-2xl'></i> <span>${message}</span>`
            : `<i class='fa fa-times-circle text-2xl'></i> <span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => {
            toast.classList.add('opacity-0');
            setTimeout(() => toast.remove(), 400);
        }, timeout);
    }
    // Анимация появления toast
    const style = document.createElement('style');
    style.innerHTML = `@keyframes toast-in { from { opacity: 0; transform: translateY(-20px);} to { opacity: 1; transform: none;} } .animate-toast-in { animation: toast-in 0.4s cubic-bezier(.4,0,.2,1); }`;
    document.head.appendChild(style);
    // Scroll reveal для всех .reveal
    document.addEventListener('DOMContentLoaded', function() {
      const revealEls = document.querySelectorAll('.reveal');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15 });
      revealEls.forEach(el => observer.observe(el));
    });
    // Плавный scroll по якорям и к верху по клику на логотип (добавляю футер)
    (function(){
        // Логотип — скролл вверх
        var logo = document.getElementById('logo-scroll-top');
        if (logo) {
            logo.addEventListener('click', function(e) {
                e.preventDefault();
                window.scrollTo({top: 0, behavior: 'smooth'});
            });
        }
        // Навигация — плавный scroll
        var nav = document.getElementById('main-nav');
        if (nav) {
            nav.querySelectorAll('a[href^="#"]').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    var targetId = this.getAttribute('href').slice(1);
                    var target = document.getElementById(targetId);
                    if (target) {
                        e.preventDefault();
                        target.scrollIntoView({behavior: 'smooth'});
                    }
                });
            });
        }
        // Футер — плавный scroll
        var footerNav = document.getElementById('footer-nav');
        if (footerNav) {
            footerNav.querySelectorAll('a.footer-anchor').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    var href = this.getAttribute('href');
                    if (window.location.pathname !== '/' && href.startsWith('/#')) {
                        // Не главная — переход на главную с якорем
                        window.location.href = href;
                        return;
                    }
                    if (window.location.pathname === '/' && href.startsWith('/#')) {
                        var targetId = href.slice(2);
                        var target = document.getElementById(targetId);
                        if (target) {
                            e.preventDefault();
                            target.scrollIntoView({behavior: 'smooth'});
                        }
                    }
                });
            });
        }
    })();
    // Динамический год в футере
    (function(){
        var yearSpan = document.getElementById('year');
        if (yearSpan) {
            yearSpan.textContent = new Date().getFullYear();
        }
    })();
    // Открытие модального окна по кнопке в хедере
    document.addEventListener('DOMContentLoaded', function() {
      function openKmModal() {
          document.getElementById('km-modal').classList.remove('hidden');
      }

      var desktopBtn = document.getElementById('header-km-modal-btn-desktop');
      if(desktopBtn) desktopBtn.onclick = openKmModal;
      
      var mobileBtn = document.getElementById('header-km-modal-btn-mobile');
      if(mobileBtn) mobileBtn.onclick = openKmModal;
      
      var burgerBtn = document.getElementById('burger-btn');
      var mobileMenu = document.getElementById('mobile-menu');
      if(burgerBtn && mobileMenu) {
          burgerBtn.addEventListener('click', function() {
              mobileMenu.classList.toggle('hidden');
          });
      }

      var mobileMenuLinks = document.querySelectorAll('.mobile-menu-link');
      mobileMenuLinks.forEach(function(link) {
          link.addEventListener('click', function() {
              if(!mobileMenu.classList.contains('hidden')) {
                  mobileMenu.classList.add('hidden');
              }
          });
      });
    });
    // --- Theme toggle ---
    document.addEventListener('DOMContentLoaded', function() {
        const html = document.documentElement;
        const btn = document.getElementById('theme-toggle-btn');
        const icon = document.getElementById('theme-toggle-icon');
        function setTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            if (icon) icon.className = theme === 'dark' ? 'fa fa-sun' : 'fa fa-moon';
        }
        function toggleTheme() {
            const current = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            setTheme(current);
        }
        if (btn) btn.addEventListener('click', toggleTheme);
        // Инициализация
        const saved = localStorage.getItem('theme');
        setTheme(saved === 'dark' ? 'dark' : 'light');
    });
    </script>
</body>
</html> 